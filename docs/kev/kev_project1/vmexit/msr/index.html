<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Model-specific register vmexit controller."><title>kev_project1::vmexit::msr - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="kev_project1" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0-nightly (07d246fc6 2025-08-31)" data-channel="nightly" data-search-js="search-449aa9bf.js" data-stringdex-js="stringdex-0e748618.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module msr</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../kev_project1/index.html">kev_<wbr>project1</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module msr</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#tasks" title="Tasks">Tasks</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In kev_<wbr>project1::<wbr>vmexit</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">kev_project1</a>::<wbr><a href="../index.html">vmexit</a></div><h1>Module <span>msr</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/kev_project1/vmexit/msr.rs.html#1-106">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Model-specific register vmexit controller.</p>
<p>x86 processors include a collection of specialized registers that permit the
customization of CPU capabilities. Each register possesses a 64-bit space,
and accessing these registers necessitates using <code>rdmsr</code> (read) or <code>wrmsr</code>
(write) instructions.</p>
<p>The <code>rdmsr</code> instruction reads a register that is determined by the index
value provided in the ECX register. The retrieved MSR value is stored in the
EDX and EAX registers, with the high-order 32 bits of the MSR value placed
in the EDX register, and the low-order 32 bits placed in the EAX register.
In 64-bit architectures, the high-order 32 bits of both the RDX and RAX
registers are set to 0.</p>
<p>The <code>wrmsr</code> instruction writes a value to a register specified in the ECX
register as an index. The value written to the MSR is obtained from the EDX
and EAX registers. Specifically, the value in EDX is written to MSR[63:32]
(high-order 32bits), and the value in EAX is written to MSR[31:0]
(low-order 32bits).</p>
<p>When managing virtual machines, the default behavior is for the host to
intercept <code>rdmsr</code>/<code>wrmsr</code> instructions from the guest. Therefore, the host
needs to emulate these MSR access requests.</p>
<h3 id="tasks"><a class="doc-anchor" href="#tasks">ยง</a>Tasks</h3>
<p>In this part, you requires to write a manager to maintain the msr. When
configuring the VCpu, the msr handlers are registered via
<a href="struct.Controller.html#method.insert" title="method kev_project1::vmexit::msr::Controller::insert"><code>Controller::insert</code></a>. After that, when the guest operating system is
trapped back to the VMM by executing either <code>rdmsr</code> or <code>wrmsr</code>, the control
passed to the <a href="struct.Controller.html#method.handle" title="method kev_project1::vmexit::msr::Controller::handle"><code>Controller::handle</code></a>. In the function, the handler finds the
corresponding msr handlers, runs the handler and reflect the result into the
VCpu state. Again, you <strong>MUST</strong> forward the vCPU instruction pointer (rip)
to prevent it from executing the same instructions infinitely.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">ยง</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Controller.html" title="struct kev_project1::vmexit::msr::Controller">Controller</a></dt><dd>Msr vmexit controller.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">ยง</a></h2><dl class="item-table"><dt><a class="trait" href="trait.Msr.html" title="trait kev_project1::vmexit::msr::Msr">Msr</a></dt><dd>Trait that represent handlers for MSR registers.</dd></dl></section></div></main></body></html>