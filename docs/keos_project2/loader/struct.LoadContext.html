<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A context that holds the necessary state for loading and initializing a user program."><title>LoadContext in keos_project2::loader - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-069232aa.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="keos_project2" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0-nightly (425a9c0a0 2025-08-17)" data-channel="nightly" data-search-js="search-b069538f.js" data-settings-js="settings-5514c975.js" ><script src="../../static.files/storage-68b7e25d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc struct"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../keos_project2/index.html">keos_<wbr>project2</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Load<wbr>Context</a></h2><h3><a href="#fields">Fields</a></h3><ul class="block structfield"><li><a href="#structfield.mm_struct" title="mm_struct">mm_struct</a></li><li><a href="#structfield.regs" title="regs">regs</a></li></ul><h3><a href="#implementations">Methods</a></h3><ul class="block method"><li><a href="#method.build_stack" title="build_stack">build_stack</a></li><li><a href="#method.load" title="load">load</a></li><li><a href="#method.load_phdr" title="load_phdr">load_phdr</a></li></ul><h3><a href="#synthetic-implementations">Auto Trait Implementations</a></h3><ul class="block synthetic-implementation"><li><a href="#impl-Freeze-for-LoadContext%3CP%3E" title="Freeze">Freeze</a></li><li><a href="#impl-RefUnwindSafe-for-LoadContext%3CP%3E" title="RefUnwindSafe">RefUnwindSafe</a></li><li><a href="#impl-Send-for-LoadContext%3CP%3E" title="Send">Send</a></li><li><a href="#impl-Sync-for-LoadContext%3CP%3E" title="Sync">Sync</a></li><li><a href="#impl-Unpin-for-LoadContext%3CP%3E" title="Unpin">Unpin</a></li><li><a href="#impl-UnwindSafe-for-LoadContext%3CP%3E" title="UnwindSafe">UnwindSafe</a></li></ul><h3><a href="#blanket-implementations">Blanket Implementations</a></h3><ul class="block blanket-implementation"><li><a href="#impl-Any-for-T" title="Any">Any</a></li><li><a href="#impl-Borrow%3CT%3E-for-T" title="Borrow&#60;T&#62;">Borrow&#60;T&#62;</a></li><li><a href="#impl-BorrowMut%3CT%3E-for-T" title="BorrowMut&#60;T&#62;">BorrowMut&#60;T&#62;</a></li><li><a href="#impl-From%3CT%3E-for-T" title="From&#60;T&#62;">From&#60;T&#62;</a></li><li><a href="#impl-Into%3CU%3E-for-T" title="Into&#60;U&#62;">Into&#60;U&#62;</a></li><li><a href="#impl-TryFrom%3CU%3E-for-T" title="TryFrom&#60;U&#62;">TryFrom&#60;U&#62;</a></li><li><a href="#impl-TryInto%3CU%3E-for-T" title="TryInto&#60;U&#62;">TryInto&#60;U&#62;</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="index.html">In keos_<wbr>project2::<wbr>loader</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">keos_project2</a>::<wbr><a href="index.html">loader</a></div><h1>Struct <span class="struct">LoadContext</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/keos_project2/loader/mod.rs.html#155-161">Source</a> </span></div><pre class="rust item-decl"><code>pub struct LoadContext&lt;P: <a class="trait" href="../pager/trait.Pager.html" title="trait keos_project2::pager::Pager">Pager</a>&gt; {
    pub mm_struct: <a class="struct" href="../mm_struct/struct.MmStruct.html" title="struct keos_project2::mm_struct::MmStruct">MmStruct</a>&lt;P&gt;,
    pub regs: Registers,
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A context that holds the necessary state for loading and initializing a user
program.</p>
<p><code>LoadContext</code> is used during the loading an ELF binary into memory. It
encapsulates both the memory layout for the program and its initial register
state, allowing the loader to fully prepare the user-space
execution context.</p>
</div></details><h2 id="fields" class="fields section-header">Fields<a href="#fields" class="anchor">§</a></h2><span id="structfield.mm_struct" class="structfield section-header"><a href="#structfield.mm_struct" class="anchor field">§</a><code>mm_struct: <a class="struct" href="../mm_struct/struct.MmStruct.html" title="struct keos_project2::mm_struct::MmStruct">MmStruct</a>&lt;P&gt;</code></span><div class="docblock"><p>Virtual memory layout for the new user program.</p>
</div><span id="structfield.regs" class="structfield section-header"><a href="#structfield.regs" class="anchor field">§</a><code>regs: Registers</code></span><div class="docblock"><p>Initial CPU register values for the user process, including the
instruction pointer.</p>
</div><h2 id="implementations" class="section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-LoadContext%3CP%3E" class="impl"><a class="src rightside" href="../../src/keos_project2/loader/mod.rs.html#163-282">Source</a><a href="#impl-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P: <a class="trait" href="../pager/trait.Pager.html" title="trait keos_project2::pager::Pager">Pager</a>&gt; <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.load_phdr" class="method"><a class="src rightside" href="../../src/keos_project2/loader/mod.rs.html#186-206">Source</a><h4 class="code-header">pub fn <a href="#method.load_phdr" class="fn">load_phdr</a>(&amp;mut self, elf: <a class="struct" href="elf/struct.Elf.html" title="struct keos_project2::loader::elf::Elf">Elf</a>&lt;'_&gt;) -&gt; Result&lt;(), <a class="enum" href="../../keos/enum.KernelError.html" title="enum keos::KernelError">KernelError</a>&gt;</h4></section></summary><div class="docblock"><p>Loads program headers (<a href="elf/struct.Phdr.html" title="struct keos_project2::loader::elf::Phdr"><code>Phdr</code></a>s) from an ELF binary into memory.</p>
<p>This function iterates over the ELF program headers and maps the
corresponding segments into the process’s memory space. It ensures
that each segment is correctly mapped according to its permissions
and alignment requirements.</p>
<h5 id="parameters"><a class="doc-anchor" href="#parameters">§</a>Parameters</h5>
<ul>
<li><code>elf</code>: The ELF binary representation containing program headers.</li>
</ul>
<h5 id="returns"><a class="doc-anchor" href="#returns">§</a>Returns</h5>
<ul>
<li><code>Ok(())</code> on success, indicating that all segments were successfully
loaded.</li>
<li><code>Err(KernelError)</code> if any error occurs during the loading process,
such as an invalid memory mapping, insufficient memory, or an
unsupported segment type.</li>
</ul>
<h5 id="behavior"><a class="doc-anchor" href="#behavior">§</a>Behavior</h5>
<ul>
<li>Iterates over all program headers using <a href="elf/struct.Elf.html#method.phdrs" title="method keos_project2::loader::elf::Elf::phdrs"><code>Elf::phdrs</code></a>.</li>
<li>Maps each segment into memory if its type is <a href="elf/enum.PType.html#variant.Load" title="variant keos_project2::loader::elf::PType::Load"><code>PType::Load</code></a>.</li>
<li>Applies appropriate memory permissions using <a href="elf/struct.Phdr.html#method.permission" title="method keos_project2::loader::elf::Phdr::permission"><code>Phdr::permission</code></a>.</li>
<li>Ensures proper alignment and memory allocation before mapping.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.build_stack" class="method"><a class="src rightside" href="../../src/keos_project2/loader/mod.rs.html#236-243">Source</a><h4 class="code-header">pub fn <a href="#method.build_stack" class="fn">build_stack</a>(&amp;mut self, arguments: &amp;[&amp;str]) -&gt; Result&lt;(), <a class="enum" href="../../keos/enum.KernelError.html" title="enum keos::KernelError">KernelError</a>&gt;</h4></section></summary><div class="docblock"><p>Builds a user stack and initializes it with arguments.</p>
<p>This function sets up a new stack for the process by allocating memory,
pushing program arguments (<code>argv</code>), and preparing the initial register
state.</p>
<h5 id="parameters-1"><a class="doc-anchor" href="#parameters-1">§</a>Parameters</h5>
<ul>
<li><code>arguments</code>: A slice of strs representing the command-line arguments
(<code>argv</code>).</li>
<li><code>regs</code>: A mutable reference to the register state, which will be
updated with the initial stack pointer (<code>sp</code>) and argument count
(<code>argc</code>).</li>
</ul>
<h5 id="returns-1"><a class="doc-anchor" href="#returns-1">§</a>Returns</h5>
<ul>
<li><code>Ok(())</code> on success, indicating that the stack has been built
correctly.</li>
<li><code>Err(KernelError)</code> if an error occurs during memory allocation or
argument copying.</li>
</ul>
<h5 id="behavior-1"><a class="doc-anchor" href="#behavior-1">§</a>Behavior</h5>
<ul>
<li>Pushes the argument strings onto the stack.</li>
<li>Sets up <code>argv</code> and <code>argc</code> for the process.</li>
<li>Aligns the stack pointer to ensure proper function call execution.</li>
</ul>
<h5 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h5>
<ul>
<li>The function must be called before transferring control to user space.</li>
<li>The memory layout should follow the standard calling convention for
argument passing.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.load" class="method"><a class="src rightside" href="../../src/keos_project2/loader/mod.rs.html#271-281">Source</a><h4 class="code-header">pub fn <a href="#method.load" class="fn">load</a>(
    self,
    file: &amp;<a class="struct" href="../../keos/fs/struct.RegularFile.html" title="struct keos::fs::RegularFile">RegularFile</a>,
    args: &amp;[&amp;str],
) -&gt; Result&lt;Self, <a class="enum" href="../../keos/enum.KernelError.html" title="enum keos::KernelError">KernelError</a>&gt;</h4></section></summary><div class="docblock"><p>Creates a new memory state and initializes a user process from an ELF
executable.</p>
<p>This function loads an ELF binary into memory, sets up the program
headers, and constructs the initial user stack with arguments. It
also prepares the register state for execution.</p>
<h5 id="parameters-2"><a class="doc-anchor" href="#parameters-2">§</a>Parameters</h5>
<ul>
<li><code>file</code>: A reference to the ELF executable file.</li>
<li><code>args</code>: A slice of strs representing the command-line arguments
(<code>argv</code>).</li>
</ul>
<h5 id="returns-2"><a class="doc-anchor" href="#returns-2">§</a>Returns</h5>
<ul>
<li><code>Ok((Self, Registers))</code> on success, where:
<ul>
<li><code>Self</code> is the initialized memory state.</li>
<li><code>Registers</code> contains the initial register values.</li>
</ul>
</li>
<li><code>Err(KernelError)</code> if an error occurs while loading the ELF file or
setting up memory.</li>
</ul>
<h5 id="behavior-2"><a class="doc-anchor" href="#behavior-2">§</a>Behavior</h5>
<ul>
<li>Parses the ELF file and validates its format.</li>
<li>Loads program headers (<a href="elf/enum.PType.html#variant.Load" title="variant keos_project2::loader::elf::PType::Load"><code>PType::Load</code></a>) into memory.</li>
<li>Allocates and builds the user stack.</li>
<li>Initializes the register state (<code>rip</code> -&gt; entry point, <code>rsp</code> -&gt; stack
pointer, arg1 -&gt; the number of arguments, arg1 -&gt; address of arguments
vector.).</li>
</ul>
</div></details></div></details></div><h2 id="synthetic-implementations" class="section-header">Auto Trait Implementations<a href="#synthetic-implementations" class="anchor">§</a></h2><div id="synthetic-implementations-list"><section id="impl-Freeze-for-LoadContext%3CP%3E" class="impl"><a href="#impl-Freeze-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; Freeze for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: Freeze,</div></h3></section><section id="impl-RefUnwindSafe-for-LoadContext%3CP%3E" class="impl"><a href="#impl-RefUnwindSafe-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; RefUnwindSafe for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: RefUnwindSafe,</div></h3></section><section id="impl-Send-for-LoadContext%3CP%3E" class="impl"><a href="#impl-Send-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; Send for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: Send,</div></h3></section><section id="impl-Sync-for-LoadContext%3CP%3E" class="impl"><a href="#impl-Sync-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; Sync for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: Sync,</div></h3></section><section id="impl-Unpin-for-LoadContext%3CP%3E" class="impl"><a href="#impl-Unpin-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; Unpin for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: Unpin,</div></h3></section><section id="impl-UnwindSafe-for-LoadContext%3CP%3E" class="impl"><a href="#impl-UnwindSafe-for-LoadContext%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P&gt; UnwindSafe for <a class="struct" href="struct.LoadContext.html" title="struct keos_project2::loader::LoadContext">LoadContext</a>&lt;P&gt;<div class="where">where
    P: UnwindSafe,</div></h3></section></div><h2 id="blanket-implementations" class="section-header">Blanket Implementations<a href="#blanket-implementations" class="anchor">§</a></h2><div id="blanket-implementations-list"><details class="toggle implementors-toggle"><summary><section id="impl-Any-for-T" class="impl"><a href="#impl-Any-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; Any for T<div class="where">where
    T: 'static + ?Sized,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.type_id" class="method trait-impl"><a href="#method.type_id" class="anchor">§</a><h4 class="code-header">fn <a class="fn">type_id</a>(&amp;self) -&gt; TypeId</h4></section></summary><div class='docblock'>Gets the <code>TypeId</code> of <code>self</code>. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Borrow%3CT%3E-for-T" class="impl"><a href="#impl-Borrow%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; Borrow&lt;T&gt; for T<div class="where">where
    T: ?Sized,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow" class="method trait-impl"><a href="#method.borrow" class="anchor">§</a><h4 class="code-header">fn <a class="fn">borrow</a>(&amp;self) -&gt; &amp;T</h4></section></summary><div class='docblock'>Immutably borrows from an owned value. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-BorrowMut%3CT%3E-for-T" class="impl"><a href="#impl-BorrowMut%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; BorrowMut&lt;T&gt; for T<div class="where">where
    T: ?Sized,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow_mut" class="method trait-impl"><a href="#method.borrow_mut" class="anchor">§</a><h4 class="code-header">fn <a class="fn">borrow_mut</a>(&amp;mut self) -&gt; &amp;mut T</h4></section></summary><div class='docblock'>Mutably borrows from an owned value. <a>Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-From%3CT%3E-for-T" class="impl"><a href="#impl-From%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; From&lt;T&gt; for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from" class="method trait-impl"><a href="#method.from" class="anchor">§</a><h4 class="code-header">fn <a class="fn">from</a>(t: T) -&gt; T</h4></section></summary><div class="docblock"><p>Returns the argument unchanged.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Into%3CU%3E-for-T" class="impl"><a href="#impl-Into%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; Into&lt;U&gt; for T<div class="where">where
    U: From&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into" class="method trait-impl"><a href="#method.into" class="anchor">§</a><h4 class="code-header">fn <a class="fn">into</a>(self) -&gt; U</h4></section></summary><div class="docblock"><p>Calls <code>U::from(self)</code>.</p>
<p>That is, this conversion is whatever the implementation of
<code>[From]&lt;T&gt; for U</code> chooses to do.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryFrom%3CU%3E-for-T" class="impl"><a href="#impl-TryFrom%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; TryFrom&lt;U&gt; for T<div class="where">where
    U: Into&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error-1" class="associatedtype trait-impl"><a href="#associatedtype.Error-1" class="anchor">§</a><h4 class="code-header">type <a class="associatedtype">Error</a> = Infallible</h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_from" class="method trait-impl"><a href="#method.try_from" class="anchor">§</a><h4 class="code-header">fn <a class="fn">try_from</a>(value: U) -&gt; Result&lt;T, &lt;T as TryFrom&lt;U&gt;&gt;::Error&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryInto%3CU%3E-for-T" class="impl"><a href="#impl-TryInto%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; TryInto&lt;U&gt; for T<div class="where">where
    U: TryFrom&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error" class="associatedtype trait-impl"><a href="#associatedtype.Error" class="anchor">§</a><h4 class="code-header">type <a class="associatedtype">Error</a> = &lt;U as TryFrom&lt;T&gt;&gt;::Error</h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_into" class="method trait-impl"><a href="#method.try_into" class="anchor">§</a><h4 class="code-header">fn <a class="fn">try_into</a>(self) -&gt; Result&lt;U, &lt;U as TryFrom&lt;T&gt;&gt;::Error&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details></div></section></div></main></body></html>